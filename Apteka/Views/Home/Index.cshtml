<!-- /.row -->
<div class="row">
    <div class="col-md-9">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Dzisiejsza Sprzedaż

            </div>
            <div class="panel-body">
                <div id="TodaySales" style="height:300px;"></div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Zobacz także

            </div>
            <div class="panel-body">
                
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Zyski miesięczne

            </div>
            <div class="panel-body">
                <div id="MonthlySummary" style="height:400px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function getPromise(url) {
        return new Promise(function(resolve, reject) {
            $.get(url, function(data){
                resolve(data);
            });
        });
    }

    function toDate(date) {
        var a = new Date(parseInt(date.substr(6)));
        console.log(a);
        return Date.UTC(a.getYear(), a.getMonth(), a.getDate());
    }

    $(function () {
        getPromise("/Chart/SalesToday").then(function (dane) {
            $('#TodaySales').highcharts({
                chart: {
                    type: 'spline'
                },
                title: {
                    text: ''
                },
                subtitle :{
                    text: ''
                },
                xAxis: {
                    type: 'datetime',
                    dateTimeLabelFormats: { // don't display the dummy year
                        month: '%e. %b',
                        year: '%b'
                    },
                    title: {
                        text: 'Data'
                    },
                },
                yAxis: {
                    title: {
                        text: 'Sprzedaż'
                    },
                    min: 0
                },
                tooltip: {
                    headerFormat: '<b>{series.name}</b><br>'
                },
                series: [{
                    name: "",
                    data: _.map(dane, function (i) {
                        return [toDate(i.Data), i.value];
                    })
                }]
            });
        });

        Promise.all([getPromise("/Chart/EarningsDaily?days=31"), getPromise("/Chart/ExpensesDaily?days=31")]).then(function (dane) {
            var serier = [{
                yAxis: 0,
                name: 'Przychód',
                data: _.map(dane[0], function (i) { console.log([toDate(i.Key), i.value]); return [toDate(i.Key), i.value]; })
            }, {
                yAxis: 1,
                name: 'Rozchód',
                data: _.map(dane[1], function (i) { console.log([toDate(i.Key), i.value]);  return [toDate(i.Key), i.value]; })
            }];
            console.log(serier);
            $('#MonthlySummary').highcharts({
                chart: {
                    type: 'spline'
                },
                title: {
                    text: ''
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    type: 'datetime',
                    dateTimeLabelFormats: { // don't display the dummy year
                        month: '%e. %b',
                        year: '%b'
                    },
                    title: {
                        text: 'Date'
                    }
                },
                yAxis: [{
                    title: {
                        text: 'Zarobki'
                    },
                    min: 0
                },
                {
                    title: {
                        text: 'Wydatki'
                    },
                    min: 0
                }],
                tooltip: {
                    headerFormat: '<b>{series.name}</b><br>',
                    pointFormat: '{point.x:%e. %b}: {point.y:.2f}'
                },

                plotOptions: {
                    spline: {
                        marker: {
                            enabled: true
                        }
                    }
                },
                series: serier
            });/*
























            console.log(_.map(dane[1], function (i) {
                return [toDate(i.Key), i.value];
            }));
            $('#MonthlySummary').highcharts({
               title: {
                    text: 'Przychód/Rozchód'
                },

                series: [{
                    name: "Przychód",
                    data: _.map(dane[0], function (i) {
                        var a = [toDate(i.Key), i.value];
                        console.log(a);
                        return a;
                    }),
                },{
                    name: "Rozchód",
                    data: _.map(dane[1], function (i) {
                        var a = [toDate(i.Key), i.value];
                        console.log(a);
                        return a;
                    }), 
                }]
            });*/
        });
    });
</script>